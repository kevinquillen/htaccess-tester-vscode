<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline'; script-src 'nonce-{{nonce}}';">
  <link href="{{stylesUri}}" rel="stylesheet">
  <title>Htaccess Tester</title>
</head>
<body>
  <!-- First Run Notice -->
  <div id="first-run-notice" class="first-run-notice">
    <div class="notice-content">
      <h3>Remote Execution Notice</h3>
      <p>This extension tests your .htaccess rules using the <strong>htaccess.madewithlove.com</strong> API.</p>
      <p>Your htaccess rules and test URLs will be sent to a remote server for evaluation. No data is stored permanently.</p>
      <p>By using this extension, you acknowledge that your test data will be transmitted over the internet.</p>
      <div class="button-group">
        <button id="acknowledge-btn">I Understand</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Error Message -->
  <div id="error-message" class="error-message"></div>

  <!-- Saved Tests Section -->
  <div class="section saved-tests-section">
    <select id="saved-tests-select">
      <option value="">-- Select a saved test --</option>
    </select>
    <button id="load-test-btn" class="secondary">Load</button>
    <button id="delete-test-btn" class="secondary">Delete</button>
  </div>

  <!-- URL Input Section -->
  <div class="section">
    <h2>Test URL</h2>
    <input type="text" id="url-input" placeholder="https://example.com/path/to/test" />
  </div>

  <!-- Htaccess Rules Section -->
  <div class="section">
    <div class="section-header">
      <h2>Htaccess Rules</h2>
      <button id="load-editor-btn" class="secondary">Load from Editor</button>
    </div>
    <textarea id="rules-textarea" placeholder="RewriteEngine On
RewriteRule ^old-page$ /new-page [R=301,L]"></textarea>
  </div>

  <!-- Server Variables Section -->
  <div class="section">
    <div class="section-header">
      <h2>Server Variables</h2>
      <button id="add-variable-btn" class="secondary">Add Variable</button>
    </div>
    <table class="variables-table">
      <thead>
        <tr>
          <th>Variable</th>
          <th>Value</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="variables-body">
      </tbody>
    </table>
  </div>

  <!-- Action Buttons -->
  <div class="section">
    <div class="button-group">
      <button id="test-btn">Test Rules</button>
      <button id="save-test-btn" class="secondary">Save Test</button>
    </div>
  </div>

  <!-- Results Section -->
  <div id="results-section" class="section" style="display: none;">
    <h2>Results</h2>

    <div class="results-header">
      <div class="result-item">
        <span class="result-label">Output URL</span>
        <span id="output-url" class="result-value"></span>
      </div>
      <div class="result-item">
        <span class="result-label">Status Code</span>
        <span id="output-status" class="result-value"></span>
      </div>
    </div>

    <div class="trace-controls">
      <label for="filter-select">Filter:</label>
      <select id="filter-select">
        <option value="ALL">All Rules</option>
        <option value="FAILED_ONLY">Failed Only</option>
        <option value="REACHED_ONLY">Reached Only</option>
        <option value="MET_ONLY">Met Only</option>
      </select>
      <button id="raw-output-btn" class="secondary">Raw Output</button>
    </div>

    <table class="trace-table">
      <thead>
        <tr>
          <th class="status-icon">Status</th>
          <th>Message</th>
          <th>Met</th>
          <th>Reached</th>
        </tr>
      </thead>
      <tbody id="trace-body">
      </tbody>
    </table>

    <div class="stats-summary">
      <div class="stat-item">
        <span class="stat-label">Total:</span>
        <span id="stats-total" class="stat-value">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Met:</span>
        <span id="stats-met" class="stat-value status-met">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Not Met:</span>
        <span id="stats-not-met" class="stat-value">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Invalid:</span>
        <span id="stats-invalid" class="stat-value status-invalid">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Not Reached:</span>
        <span id="stats-not-reached" class="stat-value">0</span>
      </div>
    </div>
  </div>

  <!-- Raw Output Modal -->
  <div id="raw-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Raw API Response</h3>
        <button id="close-raw-btn" class="secondary">Close</button>
      </div>
      <pre id="raw-content"></pre>
    </div>
  </div>

  <script nonce="{{nonce}}" src="{{scriptUri}}"></script>
</body>
</html>
